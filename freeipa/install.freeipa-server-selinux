pre_install() {
  # Not sure if this is correct for Arch Linux's SELinux packages
  if [ -s /etc/selinux/config ]; then
    . /etc/selinux/config
    FILE_CONTEXT=/etc/selinux/targeted/contexts/files/file_contexts
    if [ "${SELINUXTYPE}" == targeted -a -f ${FILE_CONTEXT} ]; then
      cp -f ${FILE_CONTEXT} ${FILE_CONTEXT}.freeipa
    fi
  fi
}

post_install() {
  semodule -s targeted -i /usr/share/selinux/targeted/ipa_httpd.pp /usr/share/selinux/targeted/ipa_dogtag.pp
  . /etc/selinux/config
  FILE_CONTEXT=/etc/selinux/targeted/contexts/files/file_contexts
  selinuxenabled
  if [ $? == 0  -a "${SELINUXTYPE}" == targeted -a -f ${FILE_CONTEXT}.freeipa ]; then
    fixfiles -C ${FILE_CONTEXT}.freeipa restore
    rm -f ${FILE_CONTEXT}.freeipa
  fi
}

pre_remove() {
  if [ -s /etc/selinux/config ]; then
    . /etc/selinux/config
    FILE_CONTEXT=/etc/selinux/targeted/contexts/files/file_contexts
    if [ "${SELINUXTYPE}" == targeted -a -f ${FILE_CONTEXT} ]; then
      cp -f ${FILE_CONTEXT} ${FILE_CONTEXT}.freeipa
    fi
  fi
}

post_remove() {
  semodule -s targeted -r ipa_httpd ipa_dogtag
  . /etc/selinux/config
  FILE_CONTEXT=/etc/selinux/targeted/contexts/files/file_contexts
  selinuxenabled
  if [ $? == 0  -a "${SELINUXTYPE}" == targeted -a -f ${FILE_CONTEXT}.freeipa ]; then
    fixfiles -C ${FILE_CONTEXT}.freeipa restore
    rm -f ${FILE_CONTEXT}.freeipa
  fi
}
